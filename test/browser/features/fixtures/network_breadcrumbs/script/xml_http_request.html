<!DOCTYPE html>
<html lang="eng-GB">

<head>
    <title>XHR</title>
    <meta charset="utf-8" />
    <script src="/node_modules/@bugsnag/browser/dist/bugsnag.min.js"></script>
    <script>
        var NOTIFY = decodeURIComponent(window.location.search.match(/NOTIFY=([^&]+)/)[1])
        var SESSIONS = decodeURIComponent(window.location.search.match(/SESSIONS=([^&]+)/)[1])
        var API_KEY = decodeURIComponent(window.location.search.match(/API_KEY=([^&]+)/)[1])

        Bugsnag.start({
            apiKey: API_KEY,
            endpoints: { notify: NOTIFY, sessions: SESSIONS },
        })

        function xhrGet(url) {
            return new Promise(function (resolve, reject) {
                var xhr = new XMLHttpRequest();
                xhr.open("GET", url);
                xhr.onload = function () {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        resolve(xhr.response)
                    } else {
                        reject({
                            status: xhr.status,
                            statusTest: xhr.statusText
                        })
                    }
                }
                xhr.send()
            })
        }

        Promise.all([
            xhrGet("xml_http_request.html"),
            xhrGet("i_dont_exist.html")
        ]).then(function() {
            throw new Error("I should have network breadcrumbs attached")
        })

    </script>
</head>

<body>
    <pre id="bugsnag-test-should-run">PENDING</pre>
    <script>
        var el = document.getElementById('bugsnag-test-should-run')
        el.textContent = el.innerText = (typeof Promise !== 'undefined' && typeof Promise.all !== 'undefined' && 'fetch' in window)
            ? 'YES'
            : 'NO'
    </script>
</body>

</html>